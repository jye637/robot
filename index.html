<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canva AI é«”é©—ï¼šå°å°ç¨‹å¼è¨­è¨ˆå¸«</title>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- å¼•å…¥ Babel (ç”¨æ–¼è§£æ JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons (å–ä»£ lucide-react) ---
        // ç‚ºäº†è®“å–®ä¸€æª”æ¡ˆèƒ½é‹ä½œï¼Œæˆ‘å€‘æ‰‹å‹•å®šç¾©é€™äº› SVG åœ–æ¡ˆ
        const IconBase = ({ children, size = 24, className = "", ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className} 
                {...props}
            >
                {children}
            </svg>
        );

        const Play = (props) => <IconBase {...props}><polygon points="5 3 19 12 5 21 5 3"></polygon></IconBase>;
        const RotateCcw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"></path><path d="M3 3v9h9"></path></IconBase>;
        const ArrowUp = (props) => <IconBase {...props}><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></IconBase>;
        const ArrowLeft = (props) => <IconBase {...props}><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></IconBase>;
        const ArrowRight = (props) => <IconBase {...props}><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></IconBase>;
        const StarIcon = (props) => <IconBase {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></IconBase>;
        const Camera = (props) => <IconBase {...props}><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></IconBase>;
        const RefreshCw = (props) => <IconBase {...props}><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></IconBase>;
        const Trophy = (props) => <IconBase {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17"></path><path d="M14 14.66V17"></path><path d="M17 22v-4.18c0-.996.762-1.847 1.76-1.928a8 8 0 1 0-15.52 0A1.996 1.996 0 0 1 7 17.82V22"></path><path d="M12 2v4"></path></IconBase>;
        const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></IconBase>;
        const ChevronRight = (props) => <IconBase {...props}><polyline points="9 18 15 12 9 6"></polyline></IconBase>;
        const Home = (props) => <IconBase {...props}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></IconBase>;
        const Zap = (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></IconBase>;


        // --- Constants & Config ---
        const SCHOOL_NAME = "é«˜é›„å¸‚è”¡æ–‡åœ‹å°";
        const GAME_TITLE = "Canva AI é«”é©—ï¼šå°å°ç¨‹å¼è¨­è¨ˆå¸«";

        const LEVELS = [
          {
            id: 1,
            name: "åˆç´šï¼šæš–èº«ç·´ç¿’",
            description: "ç†Ÿæ‚‰æ©Ÿå™¨äººæ“ä½œï¼Œèµ°å‡ºç¬¬ä¸€æ­¥ï¼",
            gridSize: 3,
            layout: [
              [2, 0, 1],
              [1, 0, 3],
              [1, 1, 1]
            ],
            start: { x: 0, y: 0, dir: 1 }, 
            goal: { x: 2, y: 1 },
            maxCommands: 6,
            certTitle: "æˆ‘æœƒæ§åˆ¶æ©Ÿå™¨äºº",
            certColor: "text-blue-500"
          },
          {
            id: 2,
            name: "ä¸­ç´šï¼šè¿·å®®æ¢éšª",
            description: "è·¯è®Šé•·äº†ï¼Œå°å¿ƒä¸è¦æ’åˆ°ç‰†å£å–”ï¼",
            gridSize: 4,
            layout: [
              [2, 0, 0, 1],
              [1, 1, 0, 1],
              [0, 0, 0, 0],
              [0, 1, 1, 3]
            ],
            start: { x: 0, y: 0, dir: 1 },
            goal: { x: 3, y: 3 },
            maxCommands: 10,
            certTitle: "ç¨‹å¼æ¢éšªå®¶",
            certColor: "text-purple-500"
          },
          {
            id: 3,
            name: "é«˜ç´šï¼šå¤§å¸«æŒ‘æˆ°",
            description: "è¤‡é›œçš„è¿·å®®ï¼é€™æ˜¯çµ¦äº”å¹´ç´šé«˜æ‰‹çš„æŒ‘æˆ°ï¼",
            gridSize: 5,
            layout: [
              [1, 3, 0, 0, 1],
              [1, 1, 1, 0, 1],
              [0, 0, 0, 0, 1],
              [0, 1, 1, 1, 1],
              [2, 0, 0, 0, 0]
            ],
            start: { x: 0, y: 4, dir: 1 },
            goal: { x: 1, y: 0 },
            maxCommands: 15,
            certTitle: "ç¨‹å¼è¨­è¨ˆå¤§å¸«",
            certColor: "text-yellow-500"
          }
        ];

        // --- Components ---

        const RobotIcon = ({ className, mood = "happy", rotation = 0 }) => (
          <svg viewBox="0 0 100 100" className={className}>
            <style>{`
              @keyframes shake {
                0%, 100% { transform: translate(0); }
                25% { transform: translate(-3px, 3px); }
                75% { transform: translate(3px, -3px); }
              }
              .animate-shake-icon {
                animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both infinite;
              }
              @keyframes bounce-icon {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-10px); }
              }
              .animate-bounce-icon {
                animation: bounce-icon 1s infinite;
              }
            `}</style>
            <g className={mood === "dance" ? "animate-bounce-icon" : mood === "error" ? "animate-shake-icon" : ""}>
              
              {/* Body */}
              <rect x="30" y="30" width="40" height="60" rx="10" 
                fill={mood === "error" ? "#FCA5A5" : "#60A5FA"} 
                stroke={mood === "error" ? "#DC2626" : "#2563EB"} 
                strokeWidth="3" 
              />
              
              {/* Head (Lighter) */}
              <rect x="25" y="20" width="50" height="40" rx="8" 
                fill={mood === "error" ? "#FDBA74" : "#A78BFA"} 
                stroke={mood === "error" ? "#DC2626" : "#7C3AED"} 
                strokeWidth="3" 
              />

              {/* Antenna / Top Light */}
              <line x1="50" y1="20" x2="50" y2="5" stroke="#374151" strokeWidth="4" />
              <circle cx="50" cy="5" r="4" fill={mood === "error" ? "#DC2626" : "#FCD34D"} />
              
              {/* Eyes */}
              <circle cx="40" cy="35" r="6" fill="white" stroke="black" strokeWidth="1" />
              <circle cx="60" cy="35" r="6" fill="white" stroke="black" strokeWidth="1" />
              <circle cx="40" cy="35" r="3" fill="black" />
              <circle cx="60" cy="35" r="3" fill="black" />

              {/* Mouth (LED) */}
              {mood === "sad" || mood === "error" ? (
                <path d="M 40 50 Q 50 45 60 50" stroke="#DC2626" strokeWidth="3" fill="none" />
              ) : (
                <path d="M 40 48 C 45 53 55 53 60 48" stroke="#34D399" strokeWidth="3" fill="none" />
              )}

              {/* Chest Screen with Zap Icon */}
              <rect x="35" y="65" width="30" height="15" rx="3" fill="#374151" />
              {/* Simple Zap path inside SVG */}
              <polygon points="48,67 43,73 47,73 46,78 52,71 47,71" fill="#FCD34D" />

              {/* Crash marks if error */}
              {mood === "error" && (
                <path d="M 35 30 L 65 50 M 65 30 L 35 50" stroke="#DC2626" strokeWidth="4" strokeLinecap="round" />
              )}
            </g>
          </svg>
        );

        function App() {
          const [page, setPage] = useState(1);
          const [currentLevelIndex, setCurrentLevelIndex] = useState(0); 
          const [commands, setCommands] = useState([]);
          const [robotState, setRobotState] = useState(LEVELS[0].start);
          const [executionStep, setExecutionStep] = useState(-1);
          const [isAnimating, setIsAnimating] = useState(false);
          const [errorIndex, setErrorIndex] = useState(-1);

          const currentLevel = LEVELS[currentLevelIndex];

          const resetGameFull = () => {
            setCommands([]);
            setCurrentLevelIndex(0);
            setRobotState(LEVELS[0].start);
            setExecutionStep(-1);
            setIsAnimating(false);
            setErrorIndex(-1);
            setPage(1);
          };

          const resetLevel = () => {
            setCommands([]);
            setRobotState(currentLevel.start);
            setExecutionStep(-1);
            setIsAnimating(false);
            setErrorIndex(-1);
          };

          const nextLevel = () => {
            if (currentLevelIndex < LEVELS.length - 1) {
              const nextIdx = currentLevelIndex + 1;
              setCurrentLevelIndex(nextIdx);
              setCommands([]);
              setRobotState(LEVELS[nextIdx].start);
              setExecutionStep(-1);
              setIsAnimating(false);
              setErrorIndex(-1);
              setPage(3); 
            } else {
              resetGameFull();
            }
          };

          const addCommand = (cmd) => {
            if (!isAnimating && commands.length < currentLevel.maxCommands) {
              setCommands([...commands, cmd]);
            }
          };

          const removeCommand = (index) => {
            if (!isAnimating) {
              const newCmds = [...commands];
              newCmds.splice(index, 1);
              setCommands(newCmds);
            }
          };

          const runSimulation = async () => {
            if (commands.length === 0 || isAnimating) return;
            setIsAnimating(true);
            setExecutionStep(0);
            setErrorIndex(-1);
            setRobotState(currentLevel.start);
          };

          useEffect(() => {
            if (executionStep >= 0 && executionStep < commands.length && errorIndex === -1 && isAnimating) {
              
              if (robotState.x === currentLevel.goal.x && robotState.y === currentLevel.goal.y) {
                setIsAnimating(false);
                setPage(5);
                return;
              }

              const timer = setTimeout(() => {
                const cmd = commands[executionStep];
                let nextState = { ...robotState };
                let collision = false;

                if (cmd === 'L') {
                  nextState.dir = (nextState.dir - 1 + 4) % 4;
                } else if (cmd === 'R') {
                  nextState.dir = (nextState.dir + 1) % 4;
                } else if (cmd === 'F') {
                  let dx = 0, dy = 0;
                  if (nextState.dir === 0) dy = -1; // N
                  if (nextState.dir === 1) dx = 1;  // E
                  if (nextState.dir === 2) dy = 1;  // S
                  if (nextState.dir === 3) dx = -1; // W

                  const nextX = nextState.x + dx;
                  const nextY = nextState.y + dy;

                  const isOutOfBounds = nextX < 0 || nextX >= currentLevel.gridSize || 
                                        nextY < 0 || nextY >= currentLevel.gridSize;
                  
                  let isWall = false;
                  if (!isOutOfBounds) {
                    if (currentLevel.layout[nextY][nextX] === 1) {
                      isWall = true;
                    }
                  }

                  if (isWall || isOutOfBounds) {
                    collision = true;
                  } else {
                    nextState.x = nextX;
                    nextState.y = nextY;
                  }
                }
                
                setRobotState(nextState);

                if (collision) {
                  setErrorIndex(executionStep);
                  setTimeout(() => {
                    setPage(4);
                    setIsAnimating(false);
                  }, 1500); 
                } else {
                  if (nextState.x === currentLevel.goal.x && nextState.y === currentLevel.goal.y) {
                    setTimeout(() => {
                      setPage(5); 
                      setIsAnimating(false);
                    }, 1000);
                  } else {
                    if (executionStep + 1 < commands.length) {
                      setExecutionStep(prev => prev + 1);
                    } else {
                      setTimeout(() => {
                        setPage(4); 
                        setIsAnimating(false);
                      }, 1000);
                    }
                  }
                }
              }, 700); 
              return () => clearTimeout(timer);
            }
          }, [executionStep, commands, robotState, errorIndex, currentLevel, isAnimating]);


          // Page 1: Cover
          if (page === 1) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-indigo-700 via-blue-800 to-purple-900 flex flex-col items-center justify-center p-4 text-white font-sans">
                <div className="bg-white/10 backdrop-blur-sm p-8 rounded-3xl shadow-2xl flex flex-col items-center text-center max-w-md w-full border border-white/20">
                  <div className="bg-white/20 p-4 rounded-full mb-6 animate-pulse">
                    <RobotIcon className="w-32 h-32" mood="happy" />
                  </div>
                  <h1 className="text-3xl md:text-4xl font-black mb-2 tracking-tight text-yellow-300 drop-shadow-lg">
                    {GAME_TITLE}
                  </h1>
                  <h2 className="text-xl mb-8 font-light tracking-widest bg-blue-600/50 px-4 py-1 rounded-full border border-blue-400">
                    {SCHOOL_NAME}
                  </h2>
                  
                  <div className="space-y-3 w-full">
                    <button 
                      onClick={() => { setCurrentLevelIndex(0); setPage(2); }}
                      className="group relative px-8 py-4 bg-yellow-400 hover:bg-yellow-300 text-blue-900 font-black text-xl rounded-2xl shadow-[0_6px_0_rgb(180,83,9)] active:shadow-none active:translate-y-1 transition-all w-full transform hover:scale-[1.02]"
                    >
                      é–‹å§‹å†’éšª
                      <span className="absolute right-4 top-1/2 -translate-y-1/2 group-hover:translate-x-1 transition-transform">
                        <Play fill="currentColor" size={24} />
                      </span>
                    </button>
                  </div>
                </div>
                <p className="mt-8 text-white/60 text-sm">Design for Kids Coding Education</p>
              </div>
            );
          }

          // Page 2: Instructions
          if (page === 2) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-300 to-purple-400 flex flex-col items-center justify-center p-4">
                <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-lg w-full relative overflow-hidden transform scale-100 transition-transform duration-500">
                  <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-yellow-400 to-orange-500"></div>
                  <h2 className="text-3xl font-black text-blue-800 mb-6 text-center border-b pb-2">ç¨‹å¼å°å¹«æ‰‹èªªæ˜</h2>
                  
                  <div className="space-y-4 mb-8">
                    <div className="flex items-center bg-blue-50 p-3 rounded-xl border border-blue-200 shadow-sm">
                      <div className="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-4 text-2xl">ğŸŒ</div>
                      <div>
                        <p className="text-gray-700 font-bold">ç›®æ¨™</p>
                        <p className="text-sm text-gray-600">å¹«åŠ©æ©Ÿå™¨äººå¾ç¶ è‰²èµ·é» (<span className='text-green-500 font-bold'>Start</span>) èµ°åˆ°é»ƒè‰²æ˜Ÿæ˜Ÿ (<span className='text-yellow-500 font-bold'>Goal</span>)ã€‚</p>
                      </div>
                    </div>
                    <div className="flex items-start bg-purple-50 p-3 rounded-xl border border-purple-200 shadow-sm">
                      <div className="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-4">
                        <ArrowUp className="text-purple-600" />
                      </div>
                      <div className="text-left">
                        <p className="text-gray-700 font-bold">æŒ‡ä»¤å¡ç‰‡</p>
                        <ul className="list-disc list-inside text-sm text-gray-600 space-y-1 mt-1">
                          <li><b>å‘å‰ (â¬†ï¸)</b>: æ©Ÿå™¨äººå‘ç›®å‰æ–¹å‘ç§»å‹•ä¸€æ ¼ã€‚</li>
                          <li><b>å·¦è½‰ (â†©ï¸)</b>: æ©Ÿå™¨äºº<b>åŸåœ°</b>å·¦è½‰ 90 åº¦ã€‚</li>
                          <li><b>å³è½‰ (â†ªï¸)</b>: æ©Ÿå™¨äºº<b>åŸåœ°</b>å³è½‰ 90 åº¦ã€‚</li>
                        </ul>
                      </div>
                    </div>
                    <div className="flex items-center bg-red-50 p-3 rounded-xl border border-red-200 shadow-sm">
                      <div className="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-4">
                        <AlertCircle className="text-red-600" />
                      </div>
                      <div>
                        <p className="text-gray-700 font-bold">é‡è¦æé†’</p>
                        <p className="text-sm text-gray-600">æ’åˆ°<b>ç‰†å£ (ğŸ§±)</b> æˆ–è¶…å‡ºåœ°åœ–é‚Šç·£å°±æœƒå¤±æ•—å–”ï¼</p>
                      </div>
                    </div>
                  </div>

                  <button 
                    onClick={() => { resetLevel(); setPage(3); }}
                    className="w-full py-4 bg-blue-600 hover:bg-blue-500 text-white font-black text-xl rounded-xl shadow-[0_6px_0_rgb(30,58,138)] active:shadow-none active:translate-y-1 transition-all"
                  >
                    æˆ‘æº–å‚™å¥½äº†ï¼é–‹å§‹ Level {currentLevel.id}
                  </button>
                </div>
              </div>
            );
          }

          // Page 3: The Game
          if (page === 3) {
            const gridSize = currentLevel.gridSize;
            
            return (
              <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-blue-100 flex flex-col items-center p-4 md:p-8">
                {/* Header */}
                <div className="w-full max-w-5xl flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                  <div className="flex items-center gap-3">
                     <div className={`
                       px-4 py-1.5 rounded-full text-white font-bold text-sm shadow-md
                       ${currentLevel.id === 1 ? 'bg-blue-500' : currentLevel.id === 2 ? 'bg-purple-500' : 'bg-yellow-500'}
                     `}>
                       Level {currentLevel.id}
                     </div>
                     <div>
                       <h2 className="text-xl font-black text-slate-800">{currentLevel.name}</h2>
                       <p className="text-sm text-slate-500 hidden md:block">{currentLevel.description}</p>
                     </div>
                  </div>
                  <button onClick={resetGameFull} className="text-slate-500 hover:text-indigo-600 flex items-center gap-1 text-sm bg-white px-3 py-1 rounded-full shadow-md border border-slate-200 transition-colors">
                    <Home size={16} /> å›é¦–é 
                  </button>
                </div>

                <div className="flex flex-col md:flex-row gap-8 w-full max-w-5xl flex-1">
                  {/* Left: Map */}
                  <div className="flex-1 bg-white p-4 md:p-6 rounded-3xl shadow-xl flex items-center justify-center min-h-[350px] order-2 md:order-1">
                    <div 
                      className="grid gap-2 w-full max-w-sm aspect-square"
                      style={{ 
                        gridTemplateColumns: `repeat(${gridSize}, minmax(0, 1fr))` 
                      }}
                    >
                      {Array.from({ length: gridSize * gridSize }).map((_, i) => {
                        const x = i % gridSize;
                        const y = Math.floor(i / gridSize);
                        const cellType = currentLevel.layout[y][x];
                        const isWall = cellType === 1;
                        const isGoal = x === currentLevel.goal.x && y === currentLevel.goal.y;
                        const isStart = cellType === 2;
                        const isRobot = x === robotState.x && y === robotState.y;

                        return (
                          <div key={i} className={`
                            aspect-square rounded-xl flex items-center justify-center relative shadow-md overflow-hidden transition-all duration-300
                            ${isWall ? 'bg-slate-500' : 'bg-white border-4 border-slate-100'}
                            ${isStart ? 'bg-green-100' : ''}
                          `}>
                            {isWall && <div className="text-3xl opacity-70">ğŸ§±</div>}
                            {isGoal && <StarIcon className="w-1/2 h-1/2 text-yellow-400 fill-yellow-400 animate-pulse drop-shadow-lg" />}
                            {isStart && !isRobot && <div className="text-xl text-green-700 font-bold opacity-50">èµ·é»</div>}
                            
                            {isRobot && (
                              <div 
                                className="absolute w-full h-full p-1 transition-all duration-700 ease-in-out z-20 pointer-events-none"
                                style={{ 
                                  transform: `rotate(${robotState.dir * 90}deg)`,
                                  transformOrigin: 'center', 
                                }}
                              >
                                  <RobotIcon 
                                   className={`w-full h-full ${errorIndex !== -1 ? 'animate-shake-icon' : isAnimating && commands[executionStep] === 'F' ? 'animate-pulse-once' : ''}`} 
                                   mood={errorIndex !== -1 ? "error" : "happy"} 
                                  />
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  {/* Right: Controls */}
                  <div className="flex-1 flex flex-col gap-4 order-1 md:order-2">
                    
                    {/* Command Sequence Display */}
                    <div className="bg-white p-4 rounded-2xl shadow-xl min-h-[140px] flex flex-col border-t-4 border-indigo-400">
                      <h3 className="text-sm text-slate-500 font-bold mb-3 flex justify-between items-center">
                        <span>æŒ‡ä»¤åºåˆ— (é»æ“Šç§»é™¤)</span>
                        <span className={`text-xs px-2 py-1 rounded font-bold transition-colors ${commands.length >= currentLevel.maxCommands ? 'text-red-600 bg-red-100 border border-red-300' : 'text-indigo-600 bg-indigo-100 border border-indigo-300'}`}>
                          é™åˆ¶ï¼š{commands.length} / {currentLevel.maxCommands}
                        </span>
                      </h3>
                      <div className="flex gap-2 flex-wrap items-center content-start max-h-[160px] overflow-y-auto p-1 -m-1">
                        {commands.map((cmd, idx) => {
                           const isCurrent = executionStep === idx;
                           const isError = errorIndex === idx;
                           return (
                            <div 
                              key={idx} 
                              onClick={() => removeCommand(idx)}
                              className={`
                                w-12 h-12 md:w-14 md:h-14 rounded-xl flex items-center justify-center text-lg font-bold border-b-4 cursor-pointer transition-all relative shrink-0
                                ${isCurrent ? 'scale-110 z-10 shadow-lg ring-4 ring-offset-2 ring-yellow-400' : 'opacity-90 hover:opacity-100 shadow-md'}
                                ${isError ? 'bg-red-500 text-white border-red-700 ring-4 ring-offset-2 ring-red-300 animate-pulse' : ''}
                                ${!isError && cmd === 'F' ? 'bg-blue-200 text-blue-700 border-blue-400' : ''}
                                ${!isError && cmd === 'L' ? 'bg-orange-200 text-orange-700 border-orange-400' : ''}
                                ${!isError && cmd === 'R' ? 'bg-green-200 text-green-700 border-green-400' : ''}
                              `}
                            >
                              {cmd === 'F' && <ArrowUp size={24} />}
                              {cmd === 'L' && <ArrowLeft size={24} />}
                              {cmd === 'R' && <ArrowRight size={24} />}
                              
                              <span className={`absolute -top-1 -right-1 w-5 h-5 text-xs rounded-full flex items-center justify-center border-2 border-white
                                ${isError ? 'bg-red-600 text-white' : 'bg-slate-700 text-white'}
                              `}>
                                {idx + 1}
                              </span>
                            </div>
                          );
                        })}
                        {commands.length === 0 && (
                          <div className="w-full h-20 border-2 border-dashed border-indigo-200 rounded-xl flex items-center justify-center text-indigo-400 text-sm">
                            é»æ“Šä¸‹æ–¹æŒ‰éˆ•åŠ å…¥æŒ‡ä»¤å¡ç‰‡...
                          </div>
                        )}
                      </div>
                      {errorIndex !== -1 && (
                        <div className="mt-auto pt-2 text-red-500 font-black text-base flex items-center gap-1 animate-bounce">
                          <AlertCircle size={20} className="fill-red-500 text-white" /> å“å‘€ï¼æ©Ÿå™¨äººæ’åˆ°äº†ï¼
                        </div>
                      )}
                    </div>

                    {/* Input Buttons */}
                    <div className="grid grid-cols-3 gap-4">
                       <button 
                        onClick={() => addCommand('L')}
                        disabled={isAnimating || commands.length >= currentLevel.maxCommands}
                        className="bg-orange-500 hover:bg-orange-400 disabled:opacity-50 text-white rounded-2xl p-4 shadow-[0_6px_0_rgb(194,65,12)] active:shadow-none active:translate-y-1 flex flex-col items-center gap-1 transition-all transform hover:scale-[1.02]"
                      >
                        <ArrowLeft className="w-8 h-8 md:w-10 md:h-10" />
                        <span className="font-black text-sm md:text-base">å·¦è½‰</span>
                      </button>

                      <button 
                        onClick={() => addCommand('F')}
                        disabled={isAnimating || commands.length >= currentLevel.maxCommands}
                        className="bg-blue-500 hover:bg-blue-400 disabled:opacity-50 text-white rounded-2xl p-4 shadow-[0_6px_0_rgb(30,58,138)] active:shadow-none active:translate-y-1 flex flex-col items-center gap-1 transition-all transform hover:scale-[1.02]"
                      >
                        <ArrowUp className="w-8 h-8 md:w-10 md:h-10" />
                        <span className="font-black text-sm md:text-base">å‘å‰</span>
                      </button>

                      <button 
                        onClick={() => addCommand('R')}
                        disabled={isAnimating || commands.length >= currentLevel.maxCommands}
                        className="bg-green-500 hover:bg-green-400 disabled:opacity-50 text-white rounded-2xl p-4 shadow-[0_6px_0_rgb(21,128,61)] active:shadow-none active:translate-y-1 flex flex-col items-center gap-1 transition-all transform hover:scale-[1.02]"
                      >
                        <ArrowRight className="w-8 h-8 md:w-10 md:h-10" />
                        <span className="font-black text-sm md:text-base">å³è½‰</span>
                      </button>
                    </div>

                    {/* Action Buttons */}
                    <div className="mt-auto flex gap-4">
                      <button 
                        onClick={resetLevel}
                        disabled={isAnimating}
                        className="flex-1 bg-slate-200 text-slate-700 font-bold py-4 rounded-xl hover:bg-slate-300 disabled:opacity-50 flex items-center justify-center gap-2 shadow-md hover:shadow-lg transition-all"
                      >
                        <RotateCcw size={20} /> é‡è¨­é—œå¡
                      </button>
                      <button 
                        onClick={runSimulation}
                        disabled={isAnimating || commands.length === 0 || errorIndex !== -1}
                        className="flex-[2] bg-yellow-400 text-blue-900 font-black text-xl py-4 rounded-xl shadow-[0_6px_0_rgb(180,83,9)] active:shadow-none active:translate-y-1 hover:bg-yellow-300 disabled:opacity-50 flex items-center justify-center gap-2 transition-all transform hover:scale-[1.02]"
                      >
                        <Play fill="currentColor" size={24} /> é‹è¡Œç¨‹å¼
                      </button>
                    </div>

                  </div>
                </div>
              </div>
            );
          }

          // Page 4: Error
          if (page === 4) {
            return (
              <div className="min-h-screen bg-red-100 flex flex-col items-center justify-center p-4 text-center">
                <div className="bg-white p-10 rounded-3xl shadow-2xl max-w-sm w-full border-4 border-red-300 transform scale-100 animate-in fade-in zoom-in duration-500">
                  <RobotIcon className="w-32 h-32 mx-auto mb-6" mood="error" />
                  <h2 className="text-3xl font-black text-red-700 mb-2">ç¨‹å¼å‡ºéŒ¯äº†ï¼</h2>
                  <p className="text-slate-600 mb-8 font-medium">
                    æˆ‘æ’åˆ°ç‰†å£/é‚Šç·£ï¼Œæˆ–æ˜¯åœ¨çµ‚é»å‰æŒ‡ä»¤ç”¨å®Œäº†ã€‚<br/>
                    è«‹å›åˆ° Level {currentLevel.id} æª¢æŸ¥<b>ç´…è‰²çš„æŒ‡ä»¤</b>ï¼
                  </p>
                  <button 
                    onClick={() => { setPage(3); setRobotState(currentLevel.start); setExecutionStep(-1); setIsAnimating(false); setErrorIndex(-1); }}
                    className="w-full py-4 bg-red-500 hover:bg-red-600 text-white font-black rounded-xl shadow-[0_6px_0_rgb(153,27,27)] active:shadow-none active:translate-y-1 flex items-center justify-center gap-2 transition-all"
                  >
                    <RefreshCw size={20} /> å›åˆ°åœ°åœ–ä¿®æ”¹
                  </button>
                </div>
              </div>
            );
          }

          // Page 5: Success
          if (page === 5) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-green-100 to-teal-200 flex flex-col items-center justify-center p-4 text-center relative overflow-hidden">
                <div className="absolute inset-0 pointer-events-none opacity-50 overflow-hidden">
                  {[...Array(15)].map((_, i) => (
                    <div 
                      key={i} 
                      className="absolute w-3 h-3 rounded-full animate-spin"
                      style={{
                        left: `${Math.random() * 100}%`,
                        top: `${Math.random() * 100}%`,
                        animationDelay: `${Math.random() * 2}s`,
                        backgroundColor: ['#FBBF24', '#34D399', '#60A5FA', '#F472B6'][Math.floor(Math.random() * 4)],
                        animationDuration: `${2 + Math.random() * 2}s`,
                      }}
                    />
                  ))}
                </div>

                <div className="bg-white p-10 rounded-3xl shadow-2xl max-w-sm w-full relative z-10 border-4 border-green-400 transform scale-100 animate-in fade-in zoom-in duration-500">
                  <div className="mb-6">
                    <RobotIcon className="w-40 h-40 mx-auto" mood="dance" />
                  </div>
                  <h2 className="text-4xl font-black text-green-600 mb-2">å¤ªæ£’äº†ï¼éé—œï¼</h2>
                  <p className="text-slate-700 mb-8 font-medium">
                    ä½ æˆåŠŸå®Œæˆäº† Level {currentLevel.id}ï¼<br/>
                    {currentLevelIndex === LEVELS.length - 1 ? "ä½ å·²ç¶“æ˜¯ç¨‹å¼è¨­è¨ˆå¤§å¸«äº†ï¼" : "ä¸‹ä¸€å€‹æŒ‘æˆ°æ­£åœ¨ç­‰ä½ ï¼"}
                  </p>
                  <button 
                    onClick={() => setPage(7)}
                    className="w-full py-4 bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-300 hover:to-orange-400 text-white font-black text-xl rounded-xl shadow-[0_6px_0_rgb(202,138,4)] active:shadow-none active:translate-y-1 transform hover:scale-[1.02] transition-all flex items-center justify-center gap-2"
                  >
                    <Trophy fill="currentColor" /> é ˜å–æ¦®è€€è­‰æ›¸
                  </button>
                </div>
              </div>
            );
          }

          // Page 7: Certificate
          if (page === 7) {
            return (
              <div className="min-h-screen bg-slate-900 flex flex-col items-center justify-center p-4 text-center relative overflow-hidden">
                <div className="absolute inset-0 bg-gradient-to-b from-indigo-900 to-purple-900"></div>
                <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-30"></div>
                <div className="absolute top-0 left-1/2 -translate-x-1/2 w-full h-1/2 bg-gradient-to-b from-yellow-300/20 to-transparent blur-3xl rounded-full pointer-events-none"></div>

                <div className="relative z-10 max-w-lg w-full bg-white/10 backdrop-blur-lg border-4 border-yellow-400 p-8 rounded-3xl shadow-2xl flex flex-col items-center transform scale-100 animate-in fade-in duration-700">
                  
                  <div className="bg-yellow-400 text-blue-900 px-6 py-2 rounded-full font-black mb-6 shadow-lg flex items-center gap-2 transform rotate-2">
                    <StarIcon fill="currentColor" size={20} /> æ¦®è€€å®Œæˆ Level {currentLevel.id} <StarIcon fill="currentColor" size={20} />
                  </div>

                  <h1 className={`text-5xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white to-gray-300 mb-4 drop-shadow-md ${currentLevel.certColor}`}>
                    {currentLevel.certTitle}
                  </h1>
                  
                  <p className="text-xl text-yellow-300 font-bold mb-2">
                    é ’ç™¼çµ¦
                  </p>
                  <p className="text-3xl text-white font-black mb-6 border-b-4 border-white/50 pb-2">
                    {SCHOOL_NAME} ç¨‹å¼è¨­è¨ˆé«˜æ‰‹
                  </p>

                  <p className="text-blue-200 text-sm mb-8">
                    åœ¨ <span className="text-white font-bold">{currentLevel.name}</span> æŒ‘æˆ°ä¸­ï¼ŒæˆåŠŸåœ°è¦åŠƒäº†ç²¾ç¢ºçš„ç¨‹å¼è·¯å¾‘ï¼Œå±•ç¾äº†å“è¶Šçš„é‚è¼¯æ€ç¶­èˆ‡å•é¡Œè§£æ±ºèƒ½åŠ›ã€‚
                  </p>

                  <div className="flex gap-4 w-full">
                    <button 
                        onClick={resetGameFull}
                        className="flex-1 py-3 text-white/70 hover:text-white text-base bg-white/10 rounded-xl hover:bg-white/20 transition-all shadow-md"
                    >
                        <Home size={18} className="inline-block mr-1" /> å›é¦–é 
                    </button>
                    
                    {currentLevelIndex < LEVELS.length - 1 ? (
                        <button 
                            onClick={nextLevel}
                            className="flex-1 py-3 bg-yellow-500 hover:bg-yellow-400 text-blue-900 font-black rounded-xl shadow-[0_4px_0_rgb(202,138,4)] active:shadow-none active:translate-y-1 flex items-center justify-center gap-1 transition-all"
                        >
                            ä¸‹ä¸€é—œæŒ‘æˆ° <ChevronRight size={18} />
                        </button>
                    ) : (
                        <button 
                            onClick={resetGameFull}
                            className="flex-1 py-3 bg-green-500 hover:bg-green-600 text-white font-black rounded-xl shadow-[0_4px_0_rgb(22,101,52)] active:shadow-none active:translate-y-1 flex items-center justify-center gap-1 transition-all"
                        >
                            <Trophy size={18} /> å®Œæˆæ‰€æœ‰æŒ‘æˆ°ï¼
                        </button>
                    )}
                  </div>
                </div>
              </div>
            );
          }

          return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
